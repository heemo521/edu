<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tutoring MVP</title>
    <style>
        /* Base theme variables */
        :root {
            --bg: #f9f9f9;
            --bg-alt: #ffffff;
            --border: #ddd;
            --text: #333;
            --header-bg: #007bff;
            --header-bg-hover: #0056b3;
            --header-text: #fff;
            --message-user-bg: #e7f1ff;
            --message-tutor-bg: #fff5e6;
        }
        /* Dark mode overrides */
        body.dark-mode {
            --bg: #1e1e1e;
            --bg-alt: #2c2c2c;
            --border: #444;
            --text: #f0f0f0;
            --header-bg: #0d6efd;
            --header-bg-hover: #0b5ed7;
            --header-text: #ffffff;
            --message-user-bg: #2d4373;
            --message-tutor-bg: #4f3e1f;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            line-height: 1.5;
            /* Combine base background color with decorative image */
            background: var(--bg) url('background.png') no-repeat center/cover;
            color: var(--text);
            transition: background-color 0.3s, color 0.3s;
        }
        header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        header h1 {
            margin: 0;
            font-size: 1.5rem;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .user-info span {
            font-weight: bold;
        }
        .toggle-theme {
            background: transparent;
            border: none;
            color: var(--header-text);
            font-size: 0.9rem;
            cursor: pointer;
        }
        .container {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background-color: var(--bg-alt);
            transition: background-color 0.3s, border-color 0.3s;
        }
        .messages {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border);
            padding: 10px;
            margin-top: 10px;
            background-color: var(--bg);
            transition: background-color 0.3s, border-color 0.3s;
            display: flex;
            flex-direction: column;
        }
        .message {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 4px;
        }
        .message.user {
            background-color: var(--message-user-bg);
            align-self: flex-end;
        }
        .message.tutor {
            background-color: var(--message-tutor-bg);
        }
        .message.system {
            background-color: var(--bg-alt);
            font-style: italic;
        }
        label {
            display: block;
            margin-top: 10px;
        }
        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 8px;
            margin-top: 4px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background-color: var(--bg);
            color: var(--text);
        }
        button {
            margin-top: 10px;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background-color: var(--header-bg);
            color: var(--header-text);
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: var(--header-bg-hover);
        }
        .notification {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
        }
        .notification.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .notification.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        /* Level up notification styling */
        .level-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ffc107;
            color: #212529;
            padding: 10px 20px;
            border-radius: 4px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            font-weight: bold;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        /* Progress bar styling */
        .progress-container {
            width: 100%;
            background-color: var(--border);
            border-radius: 4px;
            overflow: hidden;
            height: 12px;
            margin-top: 5px;
        }
        .progress-bar {
            height: 100%;
            background-color: var(--header-bg);
            width: 0;
            transition: width 0.3s;
        }

        /* History and summary styling */
        #history,
        #summary {
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 10px;
            background-color: var(--bg);
            max-height: 200px;
            overflow-y: auto;
        }

        /* Auth tabs styling */
        .auth-tabs button {
            background-color: var(--bg-alt);
            color: var(--text);
            border: 1px solid var(--border);
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        .auth-tabs button.active {
            background-color: var(--header-bg);
            color: var(--header-text);
        }

        /* Thread tabs styling */
        #threads-tabs .thread-tab {
            padding: 6px 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background-color: var(--bg-alt);
            color: var(--text);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #threads-tabs .thread-tab.active {
            background-color: var(--header-bg);
            color: var(--header-text);
        }
        #threads-tabs .thread-tab:not(.active):hover {
            background-color: var(--header-bg-hover);
            color: var(--header-text);
        }

        /* Simple modal styling */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: var(--bg-alt);
            padding: 20px;
            border-radius: 4px;
            max-width: 400px;
            width: 100%;
        }
    </style>
</head>
<body>
    <header>
        <h1>AI Tutoring</h1>
        <div class="user-info" id="user-info" style="display:none;">
            <span id="user-name"></span>
            <span id="user-subscription"></span>
            <span id="user-messages"></span>
            <button onclick="signOut()">Sign Out</button>
            <button class="toggle-theme" onclick="toggleTheme()">Toggle Theme</button>
        </div>
        <button class="toggle-theme" id="theme-button" style="display:none;" onclick="toggleTheme()">Toggle Theme</button>
    </header>
    <!-- Level up notification -->
    <div id="level-notification" class="level-notification" style="display:none;"></div>
    <div class="container">
        <div class="notification" id="notification" style="display:none;"></div>
        <div class="section" id="auth-section">
            <h2>Welcome</h2>
            <div class="auth-tabs" style="display:flex; gap:10px; margin-top:10px;">
                <button id="login-tab" class="active" onclick="showAuthForm('login')">Login</button>
                <button id="register-tab" onclick="showAuthForm('register')">Register</button>
            </div>
            <div id="login-form" class="auth-form" style="margin-top:15px;">
                <label for="login-username">Username:</label>
                <input type="text" id="login-username">
                <label for="login-password">Password:</label>
                <input type="password" id="login-password">
                <button onclick="login()">Login</button>
                <p id="login-result"></p>
            </div>
            <div id="register-form" class="auth-form" style="display:none; margin-top:15px;">
                <label for="reg-username">Username:</label>
                <input type="text" id="reg-username">
                <label for="reg-password">Password:</label>
                <input type="password" id="reg-password">
                <label for="reg-role">Role:</label>
                <input type="text" id="reg-role" value="student">
                <button onclick="register()">Register</button>
                <p id="reg-result"></p>
            </div>
        </div>

        <div class="section" id="chat-section" style="display:none;">
            <h2>Chat with Tutor</h2>
            <!-- Thread tabs for separate study sessions -->
            <div id="threads-tabs" style="margin-bottom:10px; display:flex; flex-wrap:wrap; gap:5px;"></div>
            <button id="new-thread-btn" style="margin-bottom:10px;" onclick="createThread()">+ New Thread</button>
            <!-- Warning about context summarization -->
            <div id="context-warning" style="display:none; margin-bottom:10px; color:#856404; background-color:#fff3cd; border:1px solid #ffeeba; padding:8px; border-radius:4px;">Context is long; earlier messages may be summarized.</div>
            <div class="messages" id="chat-messages"></div>
            <div style="display:flex; gap:10px; margin-top:10px; align-items:center;">
                <input type="text" id="chat-input" placeholder="Type your question here..." style="flex:1;">
                <!-- Voice input toggle -->
                <button id="voice-btn" onclick="toggleVoice()" title="Toggle voice input">Voice Off</button>
                <!-- Text-to-speech toggle -->
                <button id="tts-btn" onclick="toggleTTS()" title="Toggle speech synthesis">TTS Off</button>
                <button onclick="sendMessage()">Send</button>
            </div>
        </div>

        <div class="section" id="dashboard-section" style="display:none;">
            <h2>Dashboard</h2>
            <div style="display:flex; flex-wrap:wrap; gap:10px;">
                <button onclick="loadHistory()">Load History</button>
                <button onclick="loadDashboard()">Load Summary</button>
                <button onclick="subscribe()">Subscribe</button>
                <button onclick="cancelSubscription()">Cancel Subscription</button>
            </div>
            <div id="history" style="margin-top:15px;"></div>
            <div id="summary" style="margin-top:15px;"></div>
            <!-- Progress display for XP, level and streak -->
            <div id="progress-info" style="margin-top:15px;"></div>

            <!-- Study goals section -->
            <div id="goals-section" style="margin-top:15px;">
                <h3>Study Goals</h3>
                <div id="goals-list"></div>
                <h4>Create New Goal</h4>
                <label for="goal-topic">Topic:</label>
                <select id="goal-topic"></select>
                <label for="goal-description">Description:</label>
                <input type="text" id="goal-description" placeholder="e.g. Algebra Basics">
                <label for="goal-sessions">Target Sessions:</label>
                <input type="number" id="goal-sessions" min="1" value="5">
                <label for="goal-due">Due Date:</label>
                <input type="date" id="goal-due">
                <button onclick="createGoal()">Create Goal</button>
            </div>

            <!-- Study plans section -->
            <div id="plans-section" style="margin-top:15px;">
                <h3>Study Plans</h3>
                <button onclick="openPlanModal()">New Plan</button>
                <div id="plans-list" style="margin-top:10px;"></div>
            </div>

        <!-- Study materials section -->
        <div id="materials-section" style="margin-top:15px; display:none;">
            <h3>Study Materials</h3>
            <label for="material-subject">Subject:</label>
            <select id="material-subject"></select>
            <label for="material-category">Category:</label>
            <select id="material-category"></select>
            <div id="materials-content" style="margin-top:10px; border: 1px solid var(--border); padding:10px; border-radius:4px; background-color: var(--bg);"></div>
        </div>
        </div>
    </div>

    <!-- Plan creation modal -->
    <div id="plan-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <h3>Create Study Plan</h3>
            <div id="plan-goals" style="max-height:150px; overflow-y:auto; margin-bottom:10px;"></div>
            <label for="plan-due">Due Date:</label>
            <input type="date" id="plan-due">
            <label for="plan-recurrence">Recurrence:</label>
            <select id="plan-recurrence">
                <option value="daily">Daily</option>
                <option value="weekly" selected>Weekly</option>
                <option value="monthly">Monthly</option>
            </select>
            <div style="margin-top:10px; display:flex; gap:10px; justify-content:flex-end;">
                <button onclick="submitPlan()">Save</button>
                <button onclick="closePlanModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>